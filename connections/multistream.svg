<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="649px" preserveAspectRatio="none" style="width:447px;height:649px;" version="1.1" viewBox="0 0 447 649" width="447px" zoomAndPan="magnify"><defs><filter height="300%" id="f13imtgjy13j3q" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f13imtgjy13j3q)" height="151.5078" style="stroke: #000000; stroke-width: 2.0;" width="412" x="13" y="321.6621"/><rect fill="#FFFFFF" filter="url(#f13imtgjy13j3q)" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="392" x="23" y="375.2832"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="392" x="23" y="421.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="63" x2="63" y1="51.4883" y2="592.1016"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="365" x2="365" y1="51.4883" y2="592.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="33" y="48.5352">Initiator</text><ellipse cx="63" cy="19" fill="#FEFECE" filter="url(#f13imtgjy13j3q)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="51" x2="75" y1="33" y2="33"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="33" y="604.6367">Initiator</text><ellipse cx="63" cy="623.5898" fill="#FEFECE" filter="url(#f13imtgjy13j3q)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="51" x2="75" y1="637.5898" y2="637.5898"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="325" y="48.5352">Responder</text><ellipse cx="365" cy="19" fill="#FEFECE" filter="url(#f13imtgjy13j3q)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="353" x2="377" y1="33" y2="33"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="325" y="604.6367">Responder</text><ellipse cx="365" cy="623.5898" fill="#FEFECE" filter="url(#f13imtgjy13j3q)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="353" x2="377" y1="637.5898" y2="637.5898"/><polygon fill="#A80036" points="353,78.7988,363,82.7988,353,86.7988,357,82.7988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="63" x2="359" y1="82.7988" y2="82.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="70" y="78.0566">Open connection</text><rect fill="#EEEEEE" filter="url(#f13imtgjy13j3q)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="432" x="3" y="111.4541"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="435" y1="111.4541" y2="111.4541"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="435" y1="114.4541" y2="114.4541"/><rect fill="#EEEEEE" filter="url(#f13imtgjy13j3q)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="374" x="32" y="100.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="356" x="38" y="117.3672">Establish that both sides support multistream-select</text><path d="M19,139.1094 L19,164.1094 L405,164.1094 L405,149.1094 L395,139.1094 L19,139.1094 " fill="#FBFB77" filter="url(#f13imtgjy13j3q)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M395,139.1094 L395,149.1094 L405,149.1094 L395,139.1094 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="365" x="25" y="156.6777">Both sides may send initial multistream id simultaneously</text><polygon fill="#A80036" points="74,190.7305,64,194.7305,74,198.7305,70,194.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="68" x2="364" y1="194.7305" y2="194.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="80" y="189.9883">Send multistream protocol id</text><polygon fill="#A80036" points="353,220.041,363,224.041,353,228.041,357,224.041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="63" x2="359" y1="224.041" y2="224.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="70" y="219.2988">Send multistream protocol id</text><path d="M29,237.041 L29,262.041 L395,262.041 L395,247.041 L385,237.041 L29,237.041 " fill="#FBFB77" filter="url(#f13imtgjy13j3q)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M385,237.041 L385,247.041 L395,247.041 L385,237.041 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="345" x="35" y="254.6094">If anything other than multistream id is received, abort</text><rect fill="#EEEEEE" filter="url(#f13imtgjy13j3q)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="432" x="3" y="292.0068"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="435" y1="292.0068" y2="292.0068"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="435" y1="295.0068" y2="295.0068"/><rect fill="#EEEEEE" filter="url(#f13imtgjy13j3q)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="187" x="125.5" y="281.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="169" x="131.5" y="297.9199">Negotiate protocol to use</text><path d="M13,321.6621 L87,321.6621 L87,328.6621 L77,338.6621 L13,338.6621 L13,321.6621 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="151.5078" style="stroke: #000000; stroke-width: 2.0;" width="412" x="13" y="321.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="28" y="335.2305">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="311" x="102" y="334.2969">[until success, or Initiator gives up and closes channel]</text><polygon fill="#A80036" points="353,356.2832,363,360.2832,353,364.2832,357,360.2832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="63" x2="359" y1="360.2832" y2="360.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="70" y="355.541">Send protocol id for desired protocol</text><path d="M23,375.2832 L85,375.2832 L85,382.2832 L75,392.2832 L23,392.2832 L23,375.2832 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="392" x="23" y="375.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="388.8516">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="209" x="100" y="387.918">[protocol is supported by Responder]</text><polygon fill="#A80036" points="74,409.9043,64,413.9043,74,417.9043,70,413.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="68" x2="364" y1="413.9043" y2="413.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="80" y="409.1621">Echo back protocol id to indicate agreement</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="415" y1="422.9043" y2="422.9043"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="28" y="433.5391">[protocol is not supported]</text><polygon fill="#A80036" points="74,454.1699,64,458.1699,74,462.1699,70,458.1699" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="68" x2="364" y1="458.1699" y2="458.1699"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="80" y="453.4277">Send "na" (not available)</text><rect fill="#EEEEEE" filter="url(#f13imtgjy13j3q)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="432" x="3" y="500.8252"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="435" y1="500.8252" y2="500.8252"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="435" y1="503.8252" y2="503.8252"/><rect fill="#EEEEEE" filter="url(#f13imtgjy13j3q)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="179" x="129.5" y="490.1699"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="161" x="135.5" y="506.7383">Use negotiated protocol</text><polygon fill="#A80036" points="353,540.791,363,544.791,353,548.791,357,544.791" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="63" x2="359" y1="544.791" y2="544.791"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="70" y="540.0488">Send protocol-specific message</text><polygon fill="#A80036" points="74,570.1016,64,574.1016,74,578.1016,70,574.1016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="68" x2="364" y1="574.1016" y2="574.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="80" y="569.3594">Send protocol-specific reply</text><!--
@startuml

entity Initiator
entity Responder
Initiator -> Responder: Open connection

== Establish that both sides support multistream-select ==

note over Initiator, Responder: Both sides may send initial multistream id simultaneously
Responder -> Initiator: Send multistream protocol id
Initiator -> Responder: Send multistream protocol id
note over Initiator, Responder: If anything other than multistream id is received, abort


== Negotiate protocol to use ==


loop until success, or Initiator gives up and closes channel
  Initiator -> Responder: Send protocol id for desired protocol
  alt protocol is supported by Responder
    Responder -> Initiator: Echo back protocol id to indicate agreement
  else protocol is not supported
    Responder -> Initiator: Send "na" (not available)
  end
end

== Use negotiated protocol ==

Initiator -> Responder: Send protocol-specific message
Responder -> Initiator: Send protocol-specific reply

@enduml

PlantUML version 1.2019.05(Sat Apr 20 12:45:36 EDT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_201-b09
Operating System: Mac OS X
OS Version: 10.14.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>