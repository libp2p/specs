<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="437px" preserveAspectRatio="none" style="width:865px;height:437px;background:#FFFFFF;" version="1.1" viewBox="0 0 865 437" width="865px" zoomAndPan="magnify"><defs><filter height="300%" id="f1qjtwir91l354" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;" x1="344" x2="344" y1="53.2969" y2="106.4297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="344" x2="344" y1="106.4297" y2="147.2344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="344" x2="344" y1="147.2344" y2="380.0313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="486" x2="486" y1="53.2969" y2="106.4297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="486" x2="486" y1="106.4297" y2="147.2344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="486" x2="486" y1="147.2344" y2="380.0313"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="312" y="49.9951">Initiator</text><ellipse cx="344" cy="21" fill="#FEFECE" filter="url(#f1qjtwir91l354)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="332" x2="356" y1="35" y2="35"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="312" y="392.0264">Initiator</text><ellipse cx="344" cy="411.3281" fill="#FEFECE" filter="url(#f1qjtwir91l354)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="332" x2="356" y1="425.3281" y2="425.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78" x="444" y="49.9951">Responder</text><ellipse cx="486" cy="21" fill="#FEFECE" filter="url(#f1qjtwir91l354)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="474" x2="498" y1="35" y2="35"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78" x="444" y="392.0264">Responder</text><ellipse cx="486" cy="411.3281" fill="#FEFECE" filter="url(#f1qjtwir91l354)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="474" x2="498" y1="425.3281" y2="425.3281"/><rect fill="#EEEEEE" filter="url(#f1qjtwir91l354)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="858" x="0" y="83.8633"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="858" y1="83.8633" y2="83.8633"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="858" y1="86.8633" y2="86.8633"/><rect fill="#EEEEEE" filter="url(#f1qjtwir91l354)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="452" x="203" y="73.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="433" x="209" y="89.3638">Upgrade with security protocol from listener's multiaddr</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="98" x="366" y="130.6401">Noise handshake</text><rect fill="#EEEEEE" filter="url(#f1qjtwir91l354)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="858" x="0" y="167.8008"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="858" y1="167.8008" y2="167.8008"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="858" y1="170.8008" y2="170.8008"/><rect fill="#EEEEEE" filter="url(#f1qjtwir91l354)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="246" x="306" y="157.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="227" x="312" y="173.3013">Initial multistream handshake</text><polygon fill="#A80036" points="355,207.5,345,211.5,355,215.5,351,211.5" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="349" x2="485" y1="211.5" y2="211.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="361" y="206.4341">/multistream/1.0.0</text><polygon fill="#A80036" points="474,236.6328,484,240.6328,474,244.6328,478,240.6328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="344" x2="480" y1="240.6328" y2="240.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="351" y="235.5669">/multistream/1.0.0</text><rect fill="#EEEEEE" filter="url(#f1qjtwir91l354)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="858" x="0" y="269.1992"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="858" y1="269.1992" y2="269.1992"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="858" y1="272.1992" y2="272.1992"/><rect fill="#EEEEEE" filter="url(#f1qjtwir91l354)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="246" x="306" y="258.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="227" x="312" y="274.6997">Negotiate stream multiplexer</text><polygon fill="#A80036" points="474,313.8984,484,317.8984,474,321.8984,478,317.8984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="344" x2="480" y1="317.8984" y2="317.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="351" y="312.8325">/mplex/1.0.0</text><path d="M5,296.7656 L5,321.7656 L335,321.7656 L335,306.7656 L325,296.7656 L5,296.7656 " fill="#FBFB77" filter="url(#f1qjtwir91l354)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M325,296.7656 L325,306.7656 L335,306.7656 L325,296.7656 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="11" y="313.8325">Initiator proposes mplex for stream multiplexing</text><polygon fill="#A80036" points="355,353.0313,345,357.0313,355,361.0313,351,357.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="349" x2="485" y1="357.0313" y2="357.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="361" y="351.9653">/mplex/1.0.0</text><path d="M491,335.8984 L491,360.8984 L844,360.8984 L844,345.8984 L834,335.8984 L491,335.8984 " fill="#FBFB77" filter="url(#f1qjtwir91l354)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M834,335.8984 L834,345.8984 L844,345.8984 L834,335.8984 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="332" x="497" y="352.9653">Responder supports mplex, echoes back protocol id</text><!--MD5=[b12c4918e2ebb22c8daa87d73c2457bb]
@startuml
entity Initiator
entity Responder


== Upgrade with security protocol from listener's multiaddr ==

... Noise handshake ...

== Initial multistream handshake ==

Responder -> Initiator: /multistream/1.0.0
Initiator -> Responder: /multistream/1.0.0

== Negotiate stream multiplexer ==

Initiator -> Responder: /mplex/1.0.0
note left: Initiator proposes mplex for stream multiplexing

Responder -> Initiator: /mplex/1.0.0
note right: Responder supports mplex, echoes back protocol id
@enduml

PlantUML version 1.2021.9beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>
